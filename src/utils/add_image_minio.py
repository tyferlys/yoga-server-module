import asyncio
import base64
import uuid
from io import BytesIO

from minio import Minio

from config import get_settings

settings = get_settings()

async def add_image_minio(image_base64: str) -> str:
    minio_client = Minio(
        f"{settings.HOST_MINIO}:{settings.PORT_MINIO}",
        access_key=settings.USER_MINIO,
        secret_key=settings.PASSWORD_MINIO,
        secure=False
    )

    bucket_name = settings.NAME_BUCKET_IMAGES_MINIO
    object_name = f"{str(uuid.uuid4())}.jpg"

    image_base64 = image_base64.split(",")[1]
    base64_image_string = image_base64
    image_data = base64.b64decode(base64_image_string)

    if not minio_client.bucket_exists(bucket_name):
        minio_client.make_bucket(bucket_name)

    minio_client.put_object(
        bucket_name,
        object_name,
        BytesIO(image_data),
        len(image_data)
    )

    image_url = f"http://213.108.251.81:{settings.PORT_MINIO}/{bucket_name}/{object_name}"
    print(image_url)
    return image_url


if __name__ == "__main__":
    asyncio.run(add_image_minio(
        "data:image/jpeg;base64,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"
    ))